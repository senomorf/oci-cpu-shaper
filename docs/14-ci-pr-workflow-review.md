# §§14 – Pull Request CI Review

## Observations
- The CI workflow fans out into dedicated jobs for policy enforcement (`make agents`), linting, vulnerability scanning, race-enabled coverage, container smoke testing, and integration checks on every pull request. Each job restores Go build caches manually even though `actions/setup-go` already enables dependency caching, increasing setup time without sharing downloaded modules across jobs.【F:.github/workflows/ci.yml†L1-L116】【F:.github/workflows/ci.yml†L117-L224】
- The coverage job drives `make coverage` with the repository-wide 85% statement threshold, ensuring the Makefile guardrails execute in CI; however, no job currently exercises the `make test` target that hits every package without exclusions, so packages filtered from coverage only run under the race/coverage path.【F:.github/workflows/ci.yml†L63-L116】【F:Makefile†L53-L101】
- Integration testing restores only the Go build cache, leaving module downloads to happen from scratch on every run, and it shells out directly to `go test` instead of the Makefile helper that already codifies the Docker/cgroup guards and artifact handling for developers.【F:.github/workflows/ci.yml†L177-L224】【F:Makefile†L103-L150】

## Recommendations
1. Replace the bespoke golangci-lint action and direct `go test`/`go run` invocations with the corresponding `make lint`, `make test`, `make coverage`, `make integration`, and `make govulncheck` targets so PR automation mirrors the documented contributor workflow and benefits from the shared cache directories configured in the Makefile. This keeps formatter/linter versions consistent with developer environments and respects the repository-level cache paths under `.cache/` to shorten reruns.【F:.github/workflows/ci.yml†L23-L224】【F:Makefile†L25-L150】
2. Promote module cache reuse by adding a global `actions/cache` step for `~/go/pkg/mod` (or relying on `actions/setup-go`’s built-in module cache) in the integration and container-smoke jobs so PRs do not redownload dependencies when those jobs run after lint/test. Pair the cache with `cache-dependency-path` keyed on `go.sum` for determinism.【F:.github/workflows/ci.yml†L117-L224】
3. Introduce a lightweight formatting check job (for example, `make fmt` with `gofmt -l`/`gofumpt -l`) or enable golangci-lint’s gofmt/gofumpt linters in CI to prevent style regressions that slip past local hooks. Gate it behind the existing Makefile tooling so the ≥85% coverage and lint expectations documented for contributors stay aligned between local runs and PR validation.【F:.github/workflows/ci.yml†L33-L89】【F:Makefile†L37-L52】
4. Enable workflow-level concurrency controls (such as a `concurrency` group keyed by `${{ github.ref }}`) and `cancel-in-progress: true` to stop superseded PR runs, and surface coverage summaries directly in the PR (via `actions/github-script` or `coverallsapp/github-action`) to give reviewers quick feedback on the ≥85% requirement without downloading artifacts.【F:.github/workflows/ci.yml†L1-L174】
